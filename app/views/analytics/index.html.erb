<h1 class="text-center">Analytics</h1>

<div id="date-navigation" class="text-center my-4">
  <%= link_to 'Previous Day', analytics_path(start_date: (@start_date - 1.day).strftime('%Y-%m-%d'),
    end_date: (@end_date - 1.day).strftime('%Y-%m-%d')),
    class: 'btn btn-outline-dark mr-2' %>
  <%= link_to 'Today', analytics_path(start_date: Date.today.strftime('%Y-%m-%d'),
    end_date: Date.today.strftime('%Y-%m-%d')),
    class: 'btn btn-primary mr-2' %>
  <%= link_to 'Next Day', analytics_path(start_date: (@start_date + 1.day).strftime('%Y-%m-%d'),
    end_date: (@end_date + 1.day).strftime('%Y-%m-%d')),
    class: 'btn btn-outline-dark' %>
</div>

<div id="date-selection" data-controller="date-range" class="my-4">
  <%= form_tag analytics_path, method: :get, class: 'form-inline justify-content-center' do %>
    <div class="form-group">
      <%= label_tag :start_date, 'Select start date:', class: 'mr-2' %>
      <%= date_field_tag :start_date, @start_date, required: true,
        data: { action: "change->date-range#updateEndDateMin", date_range_target: "startDate" },
        class: 'form-control mr-2' %>
      <%= label_tag :end_date, 'Select end date:', class: 'mr-2' %>
      <%= date_field_tag :end_date, @end_date, required: true,
        data: { date_range_target: "endDate" },
        class: 'form-control mr-2' %>
      <%= submit_tag 'Submit', class: 'btn btn-primary mt-2' %>
    </div>
  <% end %>
</div>

<%# Tabs for distance and appointments %>
<ul class="nav nav-pills mb-3 nav-justified" id="pills-tab" role="tablist">
  <%# Distance tab button %>
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="pills-first-tab" data-bs-toggle="pill" data-bs-target="#pills-first" type="button" role="tab" aria-controls="pills-first" aria-selected="true">Distance</button>
  </li>
  <%# Appointments tab button %>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="pills-second-tab" data-bs-toggle="pill" data-bs-target="#pills-second" type="button" role="tab" aria-controls="pills-second" aria-selected="false">Appointments</button>
  </li>
</ul>
<div class="tab-content" id="pills-tabContent">
  <%# Distance tab content %>
  <div class="tab-pane fade show active" id="pills-first" role="tabpanel" aria-labelledby="pills-first-tab" tabindex="0">
    <%= render "distance", appointments: @appointments, total_distance: @total_distance, total_time: @total_time %>
  </div>
  <%# Appointments tab content %>
  <div class="tab-pane fade" id="pills-second" role="tabpanel" aria-labelledby="pills-second-tab" tabindex="0">
    <%= render "appointments", appointments: @appointments %>
  </div>
</div>
